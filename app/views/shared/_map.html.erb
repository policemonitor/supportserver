<div id="map-container">
  <div id="map-canvas"></div>
</div>
<script>
  var map = new GMaps({
    el: '#map-canvas',
    lat: 50.27,
    lng: 30.3125,
    zoom: 10,
    disableDefaultUI: true
  });

  markers = map.addMarkers(<%=raw @hash.to_json.html_safe %>);

  $("#search_query").autocomplete({
     source: function (request, response) {
            var matcher = new RegExp($.ui.autocomplete.escapeRegex(request.term), "i");
            var array = $.grep(<%= raw @cars.to_json %>, function (value) {
                return matcher.test(value.car_name) || matcher.test(value.car_number);
            });
            response(array);
          },
      select: function (event, ui) {
          $("#search_query").val("Екіпаж: " + ui.item.car_name);
          move_map_to(ui.item.latitude, ui.item.longitude);
          return false;
      }
  }).data("uiAutocomplete")._renderItem = function(ul, item) {
      return $("<li></li>").data("item.autocomplete", item).append("<a>Екіпаж " + item.car_name + ", держ. знак " + item.car_number + "</a>").appendTo(ul);
  };

  function move_map_to (latitude, longitude) {
    map.map.panTo({lat: latitude, lng: longitude});
  }
</script>
